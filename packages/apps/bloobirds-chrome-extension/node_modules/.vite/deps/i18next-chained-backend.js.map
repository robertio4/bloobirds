{
  "version": 3,
  "sources": ["../../../../../../node_modules/i18next-chained-backend/dist/esm/i18nextChainedBackend.js"],
  "sourcesContent": ["import _classCallCheck from '@babel/runtime/helpers/esm/classCallCheck';\nimport _createClass from '@babel/runtime/helpers/esm/createClass';\n\nvar arr = [];\nvar each = arr.forEach;\nvar slice = arr.slice;\nfunction defaults(obj) {\n  each.call(slice.call(arguments, 1), function (source) {\n    if (source) {\n      for (var prop in source) {\n        if (obj[prop] === undefined) obj[prop] = source[prop];\n      }\n    }\n  });\n  return obj;\n}\nfunction createClassOnDemand(ClassOrObject) {\n  if (!ClassOrObject) return null;\n  if (typeof ClassOrObject === 'function') return new ClassOrObject();\n  return ClassOrObject;\n}\n\nfunction getDefaults() {\n  return {\n    handleEmptyResourcesAsFailed: true,\n    cacheHitMode: 'none'\n    // reloadInterval: typeof window !== 'undefined' ? false : 60 * 60 * 1000\n    // refreshExpirationTime: 60 * 60 * 1000\n  };\n}\n\nfunction handleCorrectReadFunction(backend, language, namespace, resolver) {\n  var fc = backend.read.bind(backend);\n  if (fc.length === 2) {\n    // no callback\n    try {\n      var r = fc(language, namespace);\n      if (r && typeof r.then === 'function') {\n        // promise\n        r.then(function (data) {\n          return resolver(null, data);\n        })[\"catch\"](resolver);\n      } else {\n        // sync\n        resolver(null, r);\n      }\n    } catch (err) {\n      resolver(err);\n    }\n    return;\n  }\n\n  // normal with callback\n  fc(language, namespace, resolver);\n}\nvar Backend = /*#__PURE__*/function () {\n  function Backend(services) {\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    var i18nextOptions = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    _classCallCheck(this, Backend);\n    this.backends = [];\n    this.type = 'backend';\n    this.allOptions = i18nextOptions;\n    this.init(services, options);\n  }\n  _createClass(Backend, [{\n    key: \"init\",\n    value: function init(services) {\n      var _this = this;\n      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      var i18nextOptions = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n      this.services = services;\n      this.options = defaults(options, this.options || {}, getDefaults());\n      this.allOptions = i18nextOptions;\n      this.options.backends && this.options.backends.forEach(function (b, i) {\n        _this.backends[i] = _this.backends[i] || createClassOnDemand(b);\n        _this.backends[i].init(services, _this.options.backendOptions && _this.options.backendOptions[i] || {}, i18nextOptions);\n      });\n      if (this.services && this.options.reloadInterval) {\n        setInterval(function () {\n          return _this.reload();\n        }, this.options.reloadInterval);\n      }\n    }\n  }, {\n    key: \"read\",\n    value: function read(language, namespace, callback) {\n      var _this2 = this;\n      var bLen = this.backends.length;\n      var loadPosition = function loadPosition(pos) {\n        if (pos >= bLen) return callback(new Error('non of the backend loaded data', true)); // failed pass retry flag\n        var isLastBackend = pos === bLen - 1;\n        var lengthCheckAmount = _this2.options.handleEmptyResourcesAsFailed && !isLastBackend ? 0 : -1;\n        var backend = _this2.backends[pos];\n        if (backend.read) {\n          handleCorrectReadFunction(backend, language, namespace, function (err, data, savedAt) {\n            if (!err && data && Object.keys(data).length > lengthCheckAmount) {\n              callback(null, data, pos);\n              savePosition(pos - 1, data); // save one in front\n              if (backend.save && _this2.options.cacheHitMode && ['refresh', 'refreshAndUpdateStore'].indexOf(_this2.options.cacheHitMode) > -1) {\n                if (savedAt && _this2.options.refreshExpirationTime && savedAt + _this2.options.refreshExpirationTime > Date.now()) return;\n                var nextBackend = _this2.backends[pos + 1];\n                if (nextBackend && nextBackend.read) {\n                  handleCorrectReadFunction(nextBackend, language, namespace, function (err, data) {\n                    if (err) return;\n                    if (!data) return;\n                    if (Object.keys(data).length <= lengthCheckAmount) return;\n                    savePosition(pos, data);\n                    if (_this2.options.cacheHitMode !== 'refreshAndUpdateStore') return;\n                    if (_this2.services && _this2.services.resourceStore) {\n                      _this2.services.resourceStore.addResourceBundle(language, namespace, data);\n                    }\n                  });\n                }\n              }\n            } else {\n              loadPosition(pos + 1); // try load from next\n            }\n          });\n        } else {\n          loadPosition(pos + 1); // try load from next\n        }\n      };\n\n      var savePosition = function savePosition(pos, data) {\n        if (pos < 0) return;\n        var backend = _this2.backends[pos];\n        if (backend.save) {\n          backend.save(language, namespace, data);\n          savePosition(pos - 1, data);\n        } else {\n          savePosition(pos - 1, data);\n        }\n      };\n      loadPosition(0);\n    }\n  }, {\n    key: \"create\",\n    value: function create(languages, namespace, key, fallbackValue) {\n      var clb = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : function () {};\n      var opts = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : {};\n      this.backends.forEach(function (b) {\n        if (!b.create) return;\n        var fc = b.create.bind(b);\n        if (fc.length < 6) {\n          // no callback\n          try {\n            var r;\n            if (fc.length === 5) {\n              // future callback-less api for i18next-locize-backend\n              r = fc(languages, namespace, key, fallbackValue, opts);\n            } else {\n              r = fc(languages, namespace, key, fallbackValue);\n            }\n            if (r && typeof r.then === 'function') {\n              // promise\n              r.then(function (data) {\n                return clb(null, data);\n              })[\"catch\"](clb);\n            } else {\n              // sync\n              clb(null, r);\n            }\n          } catch (err) {\n            clb(err);\n          }\n          return;\n        }\n\n        // normal with callback\n        fc(languages, namespace, key, fallbackValue, clb /* unused callback */, opts);\n      });\n    }\n  }, {\n    key: \"reload\",\n    value: function reload() {\n      var _this3 = this;\n      var _this$services = this.services,\n        backendConnector = _this$services.backendConnector,\n        languageUtils = _this$services.languageUtils,\n        logger = _this$services.logger;\n      var currentLanguage = backendConnector.language;\n      if (currentLanguage && currentLanguage.toLowerCase() === 'cimode') return; // avoid loading resources for cimode\n\n      var toLoad = [];\n      var append = function append(lng) {\n        var lngs = languageUtils.toResolveHierarchy(lng);\n        lngs.forEach(function (l) {\n          if (toLoad.indexOf(l) < 0) toLoad.push(l);\n        });\n      };\n      append(currentLanguage);\n      if (this.allOptions.preload) this.allOptions.preload.forEach(function (l) {\n        return append(l);\n      });\n      toLoad.forEach(function (lng) {\n        _this3.allOptions.ns.forEach(function (ns) {\n          backendConnector.read(lng, ns, 'read', null, null, function (err, data) {\n            if (err) logger.warn(\"loading namespace \".concat(ns, \" for language \").concat(lng, \" failed\"), err);\n            if (!err && data) logger.log(\"loaded namespace \".concat(ns, \" for language \").concat(lng), data);\n            backendConnector.loaded(\"\".concat(lng, \"|\").concat(ns), err, data);\n          });\n        });\n      });\n    }\n  }]);\n  return Backend;\n}();\nBackend.type = 'backend';\n\nexport { Backend as default };\n"],
  "mappings": "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",
  "names": ["Backend", "loadPosition", "err", "data", "savePosition", "append"]
}
