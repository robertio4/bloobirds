import { DataBuilderContext } from './context'
import {
  getFormula,
  getSchemaFromValue,
  processCopy,
  processValue,
} from './formulas'

export function buildData(value: any, variables?: any): any {
  const context = new DataBuilderContext(variables)

  const result = processValue(value, context)

  processCopy(result)

  return result
}

export function buildDataSchema(value: any, variablesSchema?: any): any {
  return getSchemaFromValue(value, variablesSchema)
}

export function valueToString(value: any, variablesSchema: any): string {
  const formula = getFormula(value)
  if (formula) {
    return formula.toString(variablesSchema)
  } else if (value?.toString) {
    return value.toString()
  } else {
    return ''
  }
}
