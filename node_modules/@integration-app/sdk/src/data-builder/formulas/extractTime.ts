import { parseDatetime } from '../../datetime'
import { DataBuilderFormulaType, processValue } from '.'
import { DataBuilderFormulaBase } from './base'
import { DataBuilderContext } from '../context'

export class DataBuilderFormulaExtractTime extends DataBuilderFormulaBase {
  constructor(public value) {
    super(DataBuilderFormulaType.EXTRACT_TIME, value)
  }

  getValue(context: DataBuilderContext): string {
    const value = processValue(this.value, context)
    const date = parseDatetime(value)
    if (date) {
      return date.toISOString().substring(11, 19)
    } else {
      return undefined
    }
  }

  getSchema() {
    return {
      type: 'string',
      format: 'time',
    }
  }
}
