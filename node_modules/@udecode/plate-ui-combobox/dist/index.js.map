{"version":3,"file":"index.js","sources":["../src/Combobox.styles.ts","../src/Combobox.tsx"],"sourcesContent":["import { Data } from '@udecode/plate-combobox';\nimport { createStyles } from '@udecode/plate-styled-components';\nimport { css } from 'styled-components';\nimport tw from 'twin.macro';\nimport { ComboboxStyleProps } from './Combobox.types';\n\nexport const getComboboxStyles = <TData extends Data>(\n  props: ComboboxStyleProps<TData>\n) => {\n  const item = [\n    tw`flex items-center px-2 cursor-pointer`,\n    css`\n      font-size: 14px;\n      border-radius: 0;\n      min-height: 36px;\n      user-select: none;\n      color: rgb(32, 31, 30);\n    `,\n  ];\n\n  return createStyles({ prefixClassNames: 'Combobox', ...props }, [\n    {\n      root: [\n        tw`bg-white m-0 p-0 overflow-scroll`,\n        css`\n          width: 300px;\n          max-height: 288px;\n          border-radius: 0 0 2px 2px;\n          box-shadow: rgba(0, 0, 0, 0.133) 0 3.2px 7.2px 0,\n            rgba(0, 0, 0, 0.11) 0 0.6px 1.8px 0;\n\n          z-index: 500;\n        `,\n      ],\n      item: [\n        ...item,\n        css`\n          background: transparent;\n\n          :hover {\n            background: rgb(243, 242, 241);\n          }\n        `,\n      ],\n      highlightedItem: [\n        ...item,\n        css`\n          background: rgb(237, 235, 233);\n\n          :hover {\n            background: rgb(237, 235, 233);\n          }\n        `,\n      ],\n    },\n  ]);\n};\n","import React, { useCallback, useEffect } from 'react';\nimport {\n  comboboxActions,\n  comboboxSelectors,\n  Data,\n  getComboboxStoreById,\n  NoData,\n  TComboboxItem,\n  useActiveComboboxStore,\n  useComboboxControls,\n  useComboboxSelectors,\n} from '@udecode/plate-combobox';\nimport {\n  useEventEditorSelectors,\n  usePlateEditorState,\n} from '@udecode/plate-core';\nimport {\n  flip,\n  getRangeBoundingClientRect,\n  offset,\n  shift,\n  useVirtualFloating,\n} from '@udecode/plate-floating';\nimport { PortalBody } from '@udecode/plate-styled-components';\nimport { getComboboxStyles } from './Combobox.styles';\nimport { ComboboxProps } from './Combobox.types';\n\nconst ComboboxContent = <TData extends Data = NoData>(\n  props: Omit<\n    ComboboxProps<TData>,\n    | 'id'\n    | 'trigger'\n    | 'searchPattern'\n    | 'onSelectItem'\n    | 'controlled'\n    | 'maxSuggestions'\n    | 'filter'\n    | 'sort'\n  >\n) => {\n  const { component: Component, items, portalElement, onRenderItem } = props;\n\n  const targetRange = useComboboxSelectors.targetRange();\n  const filteredItems = useComboboxSelectors.filteredItems();\n  const highlightedIndex = useComboboxSelectors.highlightedIndex();\n  const floatingOptions = useComboboxSelectors.floatingOptions();\n  const editor = usePlateEditorState();\n  const combobox = useComboboxControls();\n  const activeComboboxStore = useActiveComboboxStore()!;\n  const text = useComboboxSelectors.text() ?? '';\n  const storeItems = useComboboxSelectors.items();\n  const filter = activeComboboxStore.use.filter?.();\n  const sort = activeComboboxStore.use.sort?.();\n  const maxSuggestions =\n    activeComboboxStore.use.maxSuggestions?.() ?? storeItems.length;\n\n  // Update items\n  useEffect(() => {\n    items && comboboxActions.items(items);\n  }, [items]);\n\n  // Filter items\n  useEffect(() => {\n    comboboxActions.filteredItems(\n      storeItems\n        .filter(\n          filter\n            ? filter(text)\n            : (value) => value.text.toLowerCase().startsWith(text.toLowerCase())\n        )\n        .sort(sort?.(text))\n        .slice(0, maxSuggestions)\n    );\n  }, [filter, sort, storeItems, maxSuggestions, text]);\n\n  // Get target range rect\n  const getBoundingClientRect = useCallback(\n    () => getRangeBoundingClientRect(editor, targetRange),\n    [editor, targetRange]\n  );\n\n  // Update popper position\n  const { style, floating } = useVirtualFloating({\n    placement: 'bottom-start',\n    getBoundingClientRect,\n    middleware: [offset(4), shift(), flip()],\n    ...floatingOptions,\n  });\n\n  const menuProps = combobox\n    ? combobox.getMenuProps({}, { suppressRefError: true })\n    : { ref: null };\n\n  const { root, item: styleItem, highlightedItem } = getComboboxStyles(\n    props as any\n  );\n\n  return (\n    <PortalBody element={portalElement}>\n      <ul\n        {...menuProps}\n        ref={floating}\n        style={style}\n        css={root.css}\n        className={root.className}\n      >\n        {Component ? Component({ store: activeComboboxStore }) : null}\n\n        {filteredItems.map((item, index) => {\n          const Item = onRenderItem\n            ? onRenderItem({ search: text, item: item as TComboboxItem<TData> })\n            : item.text;\n\n          const highlighted = index === highlightedIndex;\n\n          return (\n            <div\n              key={item.key}\n              css={!highlighted ? styleItem?.css : highlightedItem?.css}\n              className={\n                !highlighted ? styleItem?.className : highlightedItem?.className\n              }\n              {...combobox.getItemProps({\n                item,\n                index,\n              })}\n              onMouseDown={(e) => {\n                e.preventDefault();\n\n                const onSelectItem = getComboboxStoreById(\n                  comboboxSelectors.activeId()\n                )?.get.onSelectItem();\n                onSelectItem?.(editor, item);\n              }}\n            >\n              {Item}\n            </div>\n          );\n        })}\n      </ul>\n    </PortalBody>\n  );\n};\n\n/**\n * Register the combobox id, trigger, onSelectItem\n * Renders the combobox if active.\n */\nexport const Combobox = <TData extends Data = NoData>({\n  id,\n  trigger,\n  searchPattern,\n  onSelectItem,\n  controlled,\n  maxSuggestions,\n  filter,\n  sort,\n  floatingOptions,\n  disabled: _disabled,\n  ...props\n}: ComboboxProps<TData>) => {\n  const storeItems = useComboboxSelectors.items();\n  const disabled = _disabled ?? (!storeItems.length && !props.items?.length);\n\n  const editor = usePlateEditorState();\n  const focusedEditorId = useEventEditorSelectors.focus?.();\n  const combobox = useComboboxControls();\n  const activeId = useComboboxSelectors.activeId();\n\n  useEffect(() => {\n    if (floatingOptions) {\n      comboboxActions.floatingOptions(floatingOptions);\n    }\n  }, [floatingOptions]);\n\n  useEffect(() => {\n    comboboxActions.setComboboxById({\n      id,\n      trigger,\n      searchPattern,\n      controlled,\n      onSelectItem,\n      maxSuggestions,\n      filter,\n      sort,\n    });\n  }, [\n    id,\n    trigger,\n    searchPattern,\n    controlled,\n    onSelectItem,\n    maxSuggestions,\n    filter,\n    sort,\n  ]);\n\n  if (\n    !combobox ||\n    !editor.selection ||\n    focusedEditorId !== editor.id ||\n    activeId !== id ||\n    disabled\n  ) {\n    return null;\n  }\n\n  return <ComboboxContent {...props} />;\n};\n"],"names":["getComboboxStyles","props","item","css","createStyles","prefixClassNames","root","highlightedItem","ComboboxContent","component","Component","items","portalElement","onRenderItem","targetRange","useComboboxSelectors","filteredItems","highlightedIndex","floatingOptions","editor","usePlateEditorState","combobox","useComboboxControls","activeComboboxStore","useActiveComboboxStore","text","storeItems","filter","use","sort","maxSuggestions","length","useEffect","comboboxActions","value","toLowerCase","startsWith","slice","getBoundingClientRect","useCallback","getRangeBoundingClientRect","style","floating","useVirtualFloating","placement","middleware","offset","shift","flip","menuProps","getMenuProps","suppressRefError","ref","styleItem","React","PortalBody","className","store","map","index","Item","search","highlighted","key","getItemProps","e","preventDefault","onSelectItem","getComboboxStoreById","comboboxSelectors","activeId","get","Combobox","id","trigger","searchPattern","controlled","disabled","_disabled","focusedEditorId","useEventEditorSelectors","focus","setComboboxById","selection"],"mappings":"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"}